<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Solar UO - Voyagers</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
#info{
  position:absolute;top:10px;left:10px;
  color:white;background:rgba(0,0,0,.6);
  padding:10px;border-radius:6px;z-index:2
}
#cercano{
  position:absolute;top:50px;left:10px;
  color:#0f0;background:rgba(0,0,0,.6);
  padding:6px;border-radius:6px;font-size:14px;z-index:2;
}
#velControl{
  position:absolute;top:90px;left:10px;
  color:white;background:rgba(0,0,0,.6);
  padding:6px;border-radius:6px;font-size:14px;z-index:2;
}
#voyagerPanel{
  position:absolute;top:10px;right:10px;
  color:#0af;background:rgba(0,0,0,.6);
  padding:8px;border-radius:6px;z-index:2;font-size:12px
}
</style>
</head>
<body>

<div id="info">WASD mover ¬∑ Rat√≥n mirar ¬∑ Q/E subir/bajar</div>
<div id="cercano">Cerca de: ‚Äî</div>
<div id="velControl">Velocidad: <span id="velocidadText">10</span></div>
<div id="voyagerPanel">üõ∞Ô∏è Voyagers activas<br><small>V: cambiar foco</small></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ================= ESCENA (ORIGINAL) =================
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 50000);
camera.position.set(0, 500, 2000);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// ================= TEXTURAS (ORIGINAL - URLs exactas) =================
const loader = new THREE.TextureLoader();
const textures = {
  Sol:"https://i.postimg.cc/zGW5FLW0/sol.png  ",
  Mercurio:"https://i.postimg.cc/jSqQzfBG/mercurio.png  ",
  Venus:"https://i.postimg.cc/Znh60vrX/venus.png  ",
  Tierra:"https://i.postimg.cc/wTp1NdS6/image.png  ",
  Marte:"https://i.postimg.cc/x8S1LKp4/marte-textura.png  ",
  J√∫piter:"https://i.postimg.cc/W3mvLxSq/jupiter_textura.png  ",
  Saturno:"https://i.postimg.cc/T1Wn3qLQ/saturno.png  ",
  AnillosSaturno:"https://i.postimg.cc/SNXStZ8C/aros.png  ",
  Urano:"https://i.postimg.cc/dVFNgDp8/urano.png  ",
  Neptuno:"https://i.postimg.cc/HxFBzLb0/neptuno.png  ",
  Pluton:"https://i.postimg.cc/sDBswhc5/pluton.png  ",
  Luna:"https://i.postimg.cc/7hfrGbwg/luna.png  "
};

// ================= LUZ (ORIGINAL) =================
const sunLight = new THREE.PointLight(0xffffff, 3, 0);
scene.add(sunLight);

// ================= SOL (ORIGINAL) =================
const sunRadius = 120;
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(sunRadius, 64, 64),
  new THREE.MeshBasicMaterial({map: loader.load(textures.Sol)})
);
scene.add(sun);

// ================= GLOW (ORIGINAL) =================
const glowTexture = loader.load("https://threejs.org/examples/textures/lensflare/lensflare0.png  ");
const glowMat = new THREE.SpriteMaterial({
  map: glowTexture,
  color: 0xffddaa,
  transparent: true,
  blending: THREE.AdditiveBlending,
  depthWrite: false
});
const glow = new THREE.Sprite(glowMat);
glow.scale.set(sunRadius*8, sunRadius*8, 1); 
glow.position.set(0, 0, 0);
sun.add(glow);

// ================= AJUSTE DE C√ÅMARA (ORIGINAL) =================
camera.position.set(0, 500, sunRadius*25);

// ================= ESTRELLAS (ORIGINAL) =================
(function(){
  const g = new THREE.BufferGeometry();
  const v = [];
  for(let i=0;i<30000;i++){
    const r = 20000 + Math.random()*10000;
    const t = Math.random()*Math.PI*2;
    const p = Math.acos(THREE.MathUtils.randFloatSpread(2));
    v.push(r*Math.sin(p)*Math.cos(t), r*Math.sin(p)*Math.sin(t), r*Math.cos(p));
  }
  g.setAttribute("position", new THREE.Float32BufferAttribute(v,3));
  scene.add(new THREE.Points(g, new THREE.PointsMaterial({size:1})));
})();

// ================= CREAR PLANETA (ORIGINAL) =================
function crearPlaneta(nombre,opt){
  const mesh = new THREE.Mesh(
    new THREE.SphereGeometry(opt.radio,48,48),
    new THREE.MeshStandardMaterial({map:loader.load(textures[nombre])})
  );
  mesh.userData = {
    distancia: opt.distancia,
    angulo: Math.random()*Math.PI*2,
    velOrb: opt.velOrb,
    velRot: opt.velRot,
    inclinacion: opt.inclinacion,
    nombre: nombre,
    lunas: []
  };
  scene.add(mesh);
  return mesh;
}

// ================= PLANETAS (ORIGINAL) =================
const mercurio = crearPlaneta("Mercurio",{radio:4,distancia:400,velOrb:.00003,velRot:.001,inclinacion:7});
const venus    = crearPlaneta("Venus",{radio:7,distancia:600,velOrb:.000025,velRot:.0008,inclinacion:3});
const tierra   = crearPlaneta("Tierra",{radio:8,distancia:800,velOrb:.00002,velRot:.001,inclinacion:0});
const marte    = crearPlaneta("Marte",{radio:5,distancia:1000,velOrb:.000018,velRot:.0009,inclinacion:1.85});
const jupiter  = crearPlaneta("J√∫piter",{radio:18,distancia:1300,velOrb:.000015,velRot:.002,inclinacion:1.3});
const saturno  = crearPlaneta("Saturno",{radio:16,distancia:1600,velOrb:.000012,velRot:.0015,inclinacion:2.5});
const urano    = crearPlaneta("Urano",{radio:13,distancia:1900,velOrb:.00001,velRot:.0012,inclinacion:0.77});
const neptuno  = crearPlaneta("Neptuno",{radio:13,distancia:2200,velOrb:.000008,velRot:.001,inclinacion:1.77});
const pluton = crearPlaneta("Pluton",{radio:6,distancia:3000,velOrb:.000006,velRot:.0007,inclinacion:17});

// ================= CREAR LUNAS (ORIGINAL) =================
function crearLuna(planeta,dist,vel,nombre){
  const l = new THREE.Mesh(new THREE.SphereGeometry(2,24,24),
        new THREE.MeshStandardMaterial({map:loader.load(textures.Luna)}));
  l.userData = {orbita:planeta,distancia:dist,velocidad:vel,angulo:Math.random()*Math.PI*2,nombre:nombre};
  scene.add(l); 
  planeta.userData.lunas.push(l);
  return l;
}

// Lunas principales (ORIGINAL)
crearLuna(tierra,14,0.01,"Luna");
crearLuna(marte,6,0.008,"Fobos");
crearLuna(marte,10,0.006,"Deimos");
crearLuna(jupiter,22,0.006,"Io");
crearLuna(jupiter,28,0.005,"Europa");
crearLuna(jupiter,34,0.004,"Ganimedes");
crearLuna(jupiter,40,0.003,"Calisto");
crearLuna(saturno,22,0.004,"Tit√°n");
crearLuna(saturno,28,0.0035,"Rea");
crearLuna(saturno,34,0.003,"J√°peto");
crearLuna(saturno,40,0.0025,"Dione");
crearLuna(urano,18,0.003,"Miranda");
crearLuna(urano,22,0.0028,"Ariel");
crearLuna(urano,26,0.0025,"Umbriel");
crearLuna(urano,30,0.0022,"Titania");
crearLuna(urano,34,0.002,"Ober√≥n");
crearLuna(neptuno,18,0.0025,"Trit√≥n");
crearLuna(neptuno,24,0.0022,"Nereida");
crearLuna(pluton,8,0.0018,"Caronte");
crearLuna(pluton,12,0.0015,"Nix");
crearLuna(pluton,16,0.0013,"Hidra");

// ================= ANILLOS SATURNO (ORIGINAL) =================
const ringSatGeo = new THREE.RingGeometry(18, 50, 128);
const ringSatMat = new THREE.MeshBasicMaterial({map:loader.load(textures.AnillosSaturno), side:THREE.DoubleSide, transparent:true});
const ringSat = new THREE.Mesh(ringSatGeo, ringSatMat);
ringSat.rotation.x = Math.PI/2 + 0.3;
ringSat.rotation.z = 0.45;
scene.add(ringSat);

// ================= CINTUR√ìN DE ASTEROIDES (ORIGINAL) =================
(function(){
  const asteroidesGroup = new THREE.Group();
  const numAst = 5000;
  for(let i=0; i<numAst; i++){
    const radio = Math.random()*1 + 0.3;
    const geo = new THREE.IcosahedronGeometry(radio, 0);
    const mat = new THREE.MeshStandardMaterial({color:0x888888});
    const ast = new THREE.Mesh(geo, mat);
    const ang = Math.random()*Math.PI*2;
    const dist = 2400 + Math.random()*200;
    const yPos = THREE.MathUtils.randFloatSpread(40);
    ast.position.set(Math.cos(ang)*dist, yPos, Math.sin(ang)*dist);
    asteroidesGroup.add(ast);
  }
  scene.add(asteroidesGroup);
  function animAsteroides(){
    asteroidesGroup.children.forEach(a=>{
      const angVel = 0.00001 + Math.random()*0.00001;
      const x = a.position.x;
      const z = a.position.z;
      const dist = Math.sqrt(x*x + z*z);
      const ang = Math.atan2(z, x) + angVel;
      a.position.x = Math.cos(ang)*dist;
      a.position.z = Math.sin(ang)*dist;
    });
    requestAnimationFrame(animAsteroides);
  }
  animAsteroides();
})();

// ============== ‚ú® A√ëADIDO: VOYAGERS ‚ú® ==============
// Voyager 1 - esfera naranja con estela
const v1Geo = new THREE.SphereGeometry(1.5, 16, 16);
const v1Mat = new THREE.MeshBasicMaterial({color: 0xffaa44});
const voyager1 = new THREE.Mesh(v1Geo, v1Mat);
voyager1.position.set(800, 100, 0);
voyager1.userData = {nombre: "Voyager 1", velocidad: 0.15, direccion: new THREE.Vector3(0.4, 0.6, 0.3).normalize(), estela: []};
scene.add(voyager1);

// Voyager 2 - esfera azul con estela
const v2Geo = new THREE.SphereGeometry(1.5, 16, 16);
const v2Mat = new THREE.MeshBasicMaterial({color: 0x44aaff});
const voyager2 = new THREE.Mesh(v2Geo, v2Mat);
voyager2.position.set(-600, -50, 300);
voyager2.userData = {nombre: "Voyager 2", velocidad: 0.12, direccion: new THREE.Vector3(-0.5, 0.3, -0.6).normalize(), estela: []};
scene.add(voyager2);

// Funci√≥n para actualizar Voyagers
function actualizarVoyagers(){
  [voyager1, voyager2].forEach(v => {
    // Mover en l√≠nea recta con ligera desviaci√≥n
    v.position.add(v.userData.direccion.clone().multiplyScalar(v.userData.velocidad));
    
    // Guardar posici√≥n para la estela
    v.userData.estela.push(v.position.clone());
    if(v.userData.estela.length > 30) v.userData.estela.shift();
  });
}
// ============== ‚ú® FIN VOYAGERS ‚ú® ==============

// ================= CONTROLES (ORIGINAL) =================
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener("click", ()=>controls.lock());
const move={f:false,b:false,l:false,r:false,u:false,d:false};

let velocidad = 10;
const velocidadText = document.getElementById("velocidadText");

document.addEventListener("keydown", e=>{
  if(e.code==="KeyW")move.f=true;
  if(e.code==="KeyS")move.b=true;
  if(e.code==="KeyA")move.l=true;
  if(e.code==="KeyD")move.r=true;
  if(e.code==="KeyE")move.u=true;
  if(e.code==="KeyQ")move.d=true;
  if(e.code==="ArrowUp"){ velocidad+=2; velocidadText.textContent = velocidad; }
  if(e.code==="ArrowDown"){ velocidad=Math.max(1,velocidad-2); velocidadText.textContent = velocidad; }
});

document.addEventListener("keyup", e=>{
  if(e.code==="KeyW")move.f=false;
  if(e.code==="KeyS")move.b=false;
  if(e.code==="KeyA")move.l=false;
  if(e.code==="KeyD")move.r=false;
  if(e.code==="KeyE")move.u=false;
  if(e.code==="KeyQ")move.d=false;
});

// ================= PLANETA M√ÅS CERCANO (ORIGINAL) =================
const cercanoDiv = document.getElementById("cercano");
function actualizarCercano(){
  const todos=[mercurio,venus,tierra,marte,jupiter,saturno,urano,neptuno,pluton];
  let masCercano = {nombre:"‚Äî", dist:Infinity};
  todos.forEach(p=>{
    const d = camera.position.distanceTo(p.position);
    if(d < masCercano.dist){ masCercano = {nombre:p.userData.nombre, dist:d}; }
    p.userData.lunas.forEach(l=>{
      const dl = camera.position.distanceTo(l.position);
      if(dl < masCercano.dist){ masCercano = {nombre:l.userData.nombre, dist:dl}; }
    });
  });
  cercanoDiv.textContent = `Cerca de: ${masCercano.nombre}`;
}

// ================= ANIMACI√ìN (ORIGINAL + VOYAGERS) =================
function animate(){
  requestAnimationFrame(animate);

  if(move.f)controls.moveForward(velocidad);
  if(move.b)controls.moveForward(-velocidad);
  if(move.l)controls.moveRight(-velocidad);
  if(move.r)controls.moveRight(velocidad);
  if(move.u)camera.position.y+=velocidad;
  if(move.d)camera.position.y-=velocidad;

  [mercurio,venus,tierra,marte,jupiter,saturno,urano,neptuno,pluton].forEach(p=>{
    p.userData.angulo+=p.userData.velOrb;
    p.position.x=Math.cos(p.userData.angulo)*p.userData.distancia;
    p.position.z=Math.sin(p.userData.angulo)*p.userData.distancia;
    p.rotation.y+=p.userData.velRot;
    p.rotation.z = p.userData.inclinacion * Math.PI/180;
    p.userData.lunas.forEach(l=>{
      l.userData.angulo+=l.userData.velocidad;
      l.position.x = p.position.x + Math.cos(l.userData.angulo)*l.userData.distancia;
      l.position.z = p.position.z + Math.sin(l.userData.angulo)*l.userData.distancia;
    });
  });

  ringSat.position.copy(saturno.position);
  
  // ‚ú® Actualizar Voyagers
  actualizarVoyagers();
  
  actualizarCercano();
  renderer.render(scene,camera);
}
animate();

// ================= RESIZE (ORIGINAL) =================
addEventListener("resize",()=>{
  camera.aspect = innerWidth/innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(innerWidth,innerHeight);
});
</script>
</body>
</html>
