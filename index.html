<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>üåå Sistema Solar Realista - UO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    margin: 0; overflow: hidden; background: #000;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  }
  
  /* Panel de informaci√≥n principal */
  #info {
    position: absolute; top: 15px; left: 15px;
    color: white; background: rgba(10, 15, 30, 0.85);
    padding: 12px 16px; border-radius: 10px; z-index: 10;
    border: 1px solid rgba(100, 150, 255, 0.3);
    backdrop-filter: blur(5px);
    max-width: 320px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  }
  #info h3 { 
    margin-bottom: 8px; color: #64b5f6; font-size: 16px;
    border-bottom: 1px solid rgba(100, 181, 246, 0.3); padding-bottom: 6px;
  }
  #info p { margin: 4px 0; font-size: 13px; line-height: 1.4; color: #ccc; }
  #info kbd {
    background: rgba(100, 150, 255, 0.2); padding: 2px 6px;
    border-radius: 4px; border: 1px solid rgba(100, 150, 255, 0.4);
    font-family: monospace; font-size: 12px;
  }
  
  /* Panel de planeta cercano */
  #cercano {
    position: absolute; top: 15px; right: 15px;
    color: #4fc3f7; background: rgba(10, 15, 30, 0.85);
    padding: 10px 14px; border-radius: 8px; font-size: 14px; z-index: 10;
    border: 1px solid rgba(79, 195, 247, 0.3);
    backdrop-filter: blur(5px);
    display: flex; align-items: center; gap: 8px;
  }
  #cercano::before {
    content: "ü™ê"; font-size: 16px;
  }
  
  /* Controles de velocidad y tiempo */
  #velControl {
    position: absolute; top: 60px; right: 15px;
    color: white; background: rgba(10, 15, 30, 0.85);
    padding: 10px 14px; border-radius: 8px; font-size: 13px; z-index: 10;
    border: 1px solid rgba(100, 150, 255, 0.3);
    backdrop-filter: blur(5px);
    min-width: 200px;
  }
  #velControl .slider-container {
    display: flex; align-items: center; gap: 8px; margin-top: 6px;
  }
  #velControl input[type="range"] {
    flex: 1; cursor: pointer;
  }
  #velControl .btn {
    background: rgba(100, 150, 255, 0.3); border: none;
    color: white; padding: 3px 8px; border-radius: 4px;
    cursor: pointer; font-size: 12px; transition: 0.2s;
  }
  #velControl .btn:hover { background: rgba(100, 150, 255, 0.6); }
  #velControl .btn.active { background: #4fc3f7; color: #000; }
  
  /* Panel de informaci√≥n del planeta seleccionado */
  #planetInfo {
    position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
    color: white; background: rgba(15, 25, 45, 0.92);
    padding: 15px 25px; border-radius: 12px; z-index: 20;
    border: 1px solid rgba(100, 181, 246, 0.4);
    backdrop-filter: blur(10px);
    max-width: 600px; width: 90%;
    display: none;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
  }
  #planetInfo.visible { display: block; animation: slideUp 0.3s ease; }
  @keyframes slideUp {
    from { opacity: 0; transform: translateX(-50%) translateY(20px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }
  #planetInfo h2 {
    color: #64b5f6; margin-bottom: 8px; font-size: 20px;
    display: flex; align-items: center; gap: 10px;
  }
  #planetInfo .close {
    position: absolute; top: 10px; right: 15px;
    background: none; border: none; color: #aaa;
    font-size: 20px; cursor: pointer; transition: 0.2s;
  }
  #planetInfo .close:hover { color: white; }
  #planetInfo .data-grid {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 8px 15px; margin-top: 10px; font-size: 13px;
  }
  #planetInfo .data-item { display: flex; justify-content: space-between; }
  #planetInfo .data-label { color: #888; }
  #planetInfo .data-value { color: #4fc3f7; font-weight: 500; }
  
  /* Minimap */
  #minimap {
    position: absolute; bottom: 20px; right: 20px;
    width: 180px; height: 180px;
    background: rgba(10, 15, 30, 0.85);
    border-radius: 50%; border: 2px solid rgba(100, 150, 255, 0.4);
    z-index: 10; overflow: hidden;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
  }
  #minimapCanvas {
    width: 100%; height: 100%; display: block;
  }
  #minimapLabel {
    position: absolute; bottom: 5px; left: 50%;
    transform: translateX(-50%); color: #888;
    font-size: 11px; text-align: center; width: 100%;
  }
  
  /* Selector de planetas */
  #planetSelector {
    position: absolute; top: 50%; left: 20px;
    transform: translateY(-50%);
    background: rgba(10, 15, 30, 0.85);
    border-radius: 12px; padding: 12px 8px;
    border: 1px solid rgba(100, 150, 255, 0.3);
    backdrop-filter: blur(5px);
    display: flex; flex-direction: column; gap: 6px;
    z-index: 10;
  }
  .planet-btn {
    width: 40px; height: 40px; border-radius: 50%;
    border: 2px solid transparent; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    font-size: 18px; transition: all 0.2s;
    background: rgba(30, 40, 70, 0.6);
    position: relative;
  }
  .planet-btn:hover {
    transform: scale(1.1); border-color: #64b5f6;
    background: rgba(50, 70, 110, 0.8);
  }
  .planet-btn.active {
    border-color: #4fc3f7; box-shadow: 0 0 15px rgba(79, 195, 247, 0.5);
  }
  .planet-btn::after {
    content: attr(data-name);
    position: absolute; left: 50px; background: rgba(20, 30, 50, 0.95);
    color: white; padding: 4px 10px; border-radius: 6px;
    font-size: 12px; white-space: nowrap; opacity: 0;
    pointer-events: none; transition: 0.2s; border: 1px solid rgba(100, 150, 255, 0.3);
  }
  .planet-btn:hover::after { opacity: 1; left: 55px; }
  
  /* Loading screen */
  #loading {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(ellipse at center, #0a0f1a 0%, #000 70%);
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    color: white; z-index: 1000; transition: opacity 0.5s;
  }
  #loading.hidden { opacity: 0; pointer-events: none; }
  #loading h1 { 
    font-size: 28px; margin-bottom: 20px; color: #64b5f6;
    text-shadow: 0 0 20px rgba(100, 181, 246, 0.5);
  }
  #loading .progress {
    width: 300px; height: 6px; background: rgba(100, 150, 255, 0.2);
    border-radius: 3px; overflow: hidden; margin-bottom: 15px;
  }
  #loading .progress-bar {
    height: 100%; background: linear-gradient(90deg, #4fc3f7, #64b5f6);
    width: 0%; transition: width 0.3s; border-radius: 3px;
  }
  #loading p { color: #888; font-size: 14px; }
  
  /* Crosshair */
  #crosshair {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 20px; height: 20px;
    pointer-events: none; z-index: 5;
    opacity: 0.6;
  }
  #crosshair::before, #crosshair::after {
    content: ''; position: absolute; background: rgba(100, 181, 246, 0.7);
  }
  #crosshair::before {
    width: 20px; height: 2px; top: 9px; left: 0;
  }
  #crosshair::after {
    width: 2px; height: 20px; top: 0; left: 9px;
  }
  
  /* AU markers */
  #auMarkers {
    position: absolute; bottom: 20px; left: 20px;
    color: rgba(150, 200, 255, 0.7); font-size: 11px;
    background: rgba(10, 15, 30, 0.7); padding: 8px 12px;
    border-radius: 8px; border: 1px solid rgba(100, 150, 255, 0.2);
    z-index: 10; max-width: 200px;
  }
  
  /* Responsive */
  @media (max-width: 768px) {
    #info { max-width: 280px; font-size: 12px; }
    #planetSelector { display: none; }
    #minimap { width: 140px; height: 140px; }
  }
</style>
</head>
<body>

<!-- Loading Screen -->
<div id="loading">
  <h1>üåå Cargando Sistema Solar</h1>
  <div class="progress"><div class="progress-bar" id="progressBar"></div></div>
  <p>Preparando texturas y √≥rbitas...</p>
</div>

<!-- UI Elements -->
<div id="info">
  <h3>üéÆ Controles</h3>
  <p><kbd>WASD</kbd> Mover &nbsp; <kbd>Q/E</kbd> Subir/Bajar</p>
  <p><kbd>Rat√≥n</kbd> Mirar &nbsp; <kbd>Click</kbd> Bloquear vista</p>
  <p><kbd>1-9</kbd> Ir a planeta &nbsp; <kbd>P</kbd> Pausar tiempo</p>
  <p><kbd>+/-</kbd> Velocidad &nbsp; <kbd>C</kbd> Reset c√°mara</p>
  <p style="margin-top:8px;color:#888;font-size:12px">
    üí° Haz click en un planeta para ver informaci√≥n
  </p>
</div>

<div id="cercano">Cargando...</div>

<div id="velControl">
  <div>‚è±Ô∏è Velocidad: <strong id="velocidadText">1.0x</strong></div>
  <div class="slider-container">
    <button class="btn" id="btnSlower">‚àí</button>
    <input type="range" id="velSlider" min="0.1" max="10" step="0.1" value="1">
    <button class="btn" id="btnFaster">+</button>
    <button class="btn" id="btnPause">‚èØÔ∏è</button>
  </div>
  <div style="margin-top:6px;font-size:12px;color:#888">
    Tiempo simulado: <span id="simTime">0</span> d√≠as terrestres
  </div>
</div>

<div id="planetSelector">
  <button class="planet-btn active" data-target="sun" data-name="Sol">‚òÄÔ∏è</button>
  <button class="planet-btn" data-target="mercurio" data-name="Mercurio">‚òøÔ∏è</button>
  <button class="planet-btn" data-target="venus" data-name="Venus">‚ôÄÔ∏è</button>
  <button class="planet-btn" data-target="tierra" data-name="Tierra">üú®</button>
  <button class="planet-btn" data-target="marte" data-name="Marte">‚ôÇÔ∏è</button>
  <button class="planet-btn" data-target="jupiter" data-name="J√∫piter">‚ôÉ</button>
  <button class="planet-btn" data-target="saturno" data-name="Saturno">‚ôÑ</button>
  <button class="planet-btn" data-target="urano" data-name="Urano">‚ôÖ</button>
  <button class="planet-btn" data-target="neptuno" data-name="Neptuno">‚ôÜ</button>
</div>

<div id="planetInfo">
  <button class="close" id="closePlanetInfo">√ó</button>
  <h2><span id="planetIcon">ü™ê</span> <span id="planetName">Planeta</span></h2>
  <p id="planetDesc" style="color:#bbb;font-size:14px;line-height:1.4"></p>
  <div class="data-grid">
    <div class="data-item"><span class="data-label">Di√°metro:</span><span class="data-value" id="planetDiameter">‚Äî</span></div>
    <div class="data-item"><span class="data-label">Distancia al Sol:</span><span class="data-value" id="planetDistance">‚Äî</span></div>
    <div class="data-item"><span class="data-label">D√≠a orbital:</span><span class="data-value" id="planetOrbit">‚Äî</span></div>
    <div class="data-item"><span class="data-label">D√≠a rotaci√≥n:</span><span class="data-value" id="planetRotation">‚Äî</span></div>
    <div class="data-item"><span class="data-label">Lunas:</span><span class="data-value" id="planetMoons">‚Äî</span></div>
    <div class="data-item"><span class="data-label">Temp. media:</span><span class="data-value" id="planetTemp">‚Äî</span></div>
  </div>
</div>

<div id="minimap">
  <canvas id="minimapCanvas"></canvas>
  <div id="minimapLabel">Vista orbital</div>
</div>

<div id="auMarkers">
  <strong>üìè Escala:</strong><br>
  1 UA = 149.6 millones km<br>
  <span style="color:#64b5f6">‚Ä¢</span> Mercurio: 0.4 UA<br>
  <span style="color:#81c784">‚Ä¢</span> Tierra: 1.0 UA<br>
  <span style="color:#ffb74d">‚Ä¢</span> J√∫piter: 5.2 UA
</div>

<div id="crosshair"></div>

<!-- Three.js Libraries -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ================= CONFIGURACI√ìN GLOBAL =================
const CONFIG = {
  scale: 0.00002, // Factor de escala para distancias (1 km = 0.00002 unidades)
  timeSpeed: 1,   // Velocidad del tiempo simulado
  paused: false,  // Estado de pausa
  showOrbits: true,
  cameraSpeed: 15
};

// Datos realistas de planetas (valores aproximados para visualizaci√≥n)
const PLANET_DATA = {
  Sol: {
    name: "Sol", icon: "‚òÄÔ∏è", radius: 696340, diameter: "1,392,700 km",
    distance: "0 km", orbit: "‚Äî", rotation: "27 d√≠as",
    moons: "8 planetas + otros", temp: "5,500¬∞C (superficie)",
    desc: "Estrella tipo G2V que contiene el 99.86% de la masa del Sistema Solar. Su gravedad mantiene en √≥rbita a todos los cuerpos celestes del sistema."
  },
  Mercurio: {
    name: "Mercurio", icon: "‚òøÔ∏è", radius: 2440, diameter: "4,880 km",
    distance: "57.9 millones km (0.39 UA)", orbit: "88 d√≠as", rotation: "59 d√≠as",
    moons: "0", temp: "167¬∞C (media)",
    desc: "El planeta m√°s peque√±o y cercano al Sol. Sin atm√≥sfera significativa, tiene extremos t√©rmicos: 430¬∞C de d√≠a y -180¬∞C de noche."
  },
  Venus: {
    name: "Venus", icon: "‚ôÄÔ∏è", radius: 6052, diameter: "12,104 km",
    distance: "108.2 millones km (0.72 UA)", orbit: "225 d√≠as", rotation: "243 d√≠as (retr√≥grado)",
    moons: "0", temp: "464¬∞C",
    desc: "Cubierto por densas nubes de √°cido sulf√∫rico. Su efecto invernadero descontrolado lo convierte en el planeta m√°s caliente del sistema."
  },
  Tierra: {
    name: "Tierra", icon: "üú®", radius: 6371, diameter: "12,742 km",
    distance: "149.6 millones km (1 UA)", orbit: "365.25 d√≠as", rotation: "24 horas",
    moons: "1 (Luna)", temp: "15¬∞C",
    desc: "√önico mundo conocido con vida. 71% de su superficie est√° cubierta por agua l√≠quida. Su atm√≥sfera rica en ox√≠geno permite la vida compleja."
  },
  Marte: {
    name: "Marte", icon: "‚ôÇÔ∏è", radius: 3390, diameter: "6,779 km",
    distance: "227.9 millones km (1.52 UA)", orbit: "687 d√≠as", rotation: "24.6 horas",
    moons: "2 (Fobos, Deimos)", temp: "-63¬∞C",
    desc: "El 'Planeta Rojo' por su √≥xido de hierro superficial. Tiene el volc√°n m√°s grande del sistema solar: Olympus Mons (21 km de altura)."
  },
  J√∫piter: {
    name: "J√∫piter", icon: "‚ôÉ", radius: 69911, diameter: "139,820 km",
    distance: "778.5 millones km (5.2 UA)", orbit: "12 a√±os", rotation: "9.9 horas",
    moons: "95 confirmadas", temp: "-110¬∞C",
    desc: "Gigante gaseoso con la Gran Mancha Roja, una tormenta activa por al menos 400 a√±os. Su fuerte gravedad protege a la Tierra de asteroides."
  },
  Saturno: {
    name: "Saturno", icon: "‚ôÑ", radius: 58232, diameter: "116,460 km",
    distance: "1.43 mil millones km (9.5 UA)", orbit: "29 a√±os", rotation: "10.7 horas",
    moons: "146 confirmadas", temp: "-140¬∞C",
    desc: "Famoso por sus espectaculares anillos de hielo y roca. Es el planeta menos denso: flotar√≠a en un oc√©ano suficientemente grande."
  },
  Urano: {
    name: "Urano", icon: "‚ôÖ", radius: 25362, diameter: "50,724 km",
    distance: "2.87 mil millones km (19.2 UA)", orbit: "84 a√±os", rotation: "17.2 horas (inclinado 98¬∞)",
    moons: "28 confirmadas", temp: "-195¬∞C",
    desc: "Gigante de hielo que rota 'de lado'. Su color cian proviene del metano en su atm√≥sfera que absorbe la luz roja."
  },
  Neptuno: {
    name: "Neptuno", icon: "‚ôÜ", radius: 24622, diameter: "49,244 km",
    distance: "4.50 mil millones km (30.1 UA)", orbit: "165 a√±os", rotation: "16.1 horas",
    moons: "16 confirmadas", temp: "-200¬∞C",
    desc: "El planeta m√°s ventoso: r√°fagas de hasta 2,100 km/h. Fue el primero descubierto mediante c√°lculos matem√°ticos antes de ser observado."
  }
};

// ================= VARIABLES GLOBALES =================
let scene, camera, renderer, controls;
let sun, planets = {}, moons = {}, rings = {};
let asteroidBelt, kuiperBelt, orbitLines = {};
let minimapCtx, minimapCanvas;
let timeElapsed = 0;
let selectedPlanet = null;
let raycaster, mouse;

// ================= INICIALIZACI√ìN =================
function init() {
  // Escena
  scene = new THREE.Scene();
  scene.fog = new THREE.FogExp2(0x000011, 0.00008);
  
  // C√°mara
  camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 200000);
  camera.position.set(0, 800, 2500);
  
  // Renderer
  renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
  renderer.setSize(innerWidth, innerHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.2;
  document.body.appendChild(renderer.domElement);
  
  // Controles
  controls = new THREE.PointerLockControls(camera, document.body);
  document.body.addEventListener('click', () => {
    if (!controls.isLocked) controls.lock();
  }, false);
  
  // Raycaster para selecci√≥n de planetas
  raycaster = new THREE.Raycaster();
  mouse = new THREE.Vector2();
  document.addEventListener('mousemove', onMouseMove, false);
  document.addEventListener('click', onClick, false);
  
  // Iluminaci√≥n
  const ambientLight = new THREE.AmbientLight(0x222233, 0.3);
  scene.add(ambientLight);
  
  const sunLight = new THREE.PointLight(0xffffff, 2.5, 80000, 2);
  sunLight.position.set(0, 0, 0);
  scene.add(sunLight);
  
  // Luz direccional suave para relleno
  const fillLight = new THREE.DirectionalLight(0x4466aa, 0.15);
  fillLight.position.set(1000, 500, 1000);
  scene.add(fillLight);
  
  // Cargar texturas con progreso
  loadAssets();
  
  // Configurar UI
  setupUI();
  
  // Iniciar minimap
  initMinimap();
  
  // Event listeners
  setupEventListeners();
  
  // Iniciar animaci√≥n
  animate();
}

// ================= CARGA DE RECURSOS =================
let loadedTextures = 0;
const totalTextures = 13;

function updateProgress() {
  loadedTextures++;
  const percent = Math.min(100, Math.round((loadedTextures / totalTextures) * 100));
  document.getElementById('progressBar').style.width = percent + '%';
  if (loadedTextures >= totalTextures) {
    setTimeout(() => {
      document.getElementById('loading').classList.add('hidden');
    }, 300);
  }
}

function loadAssets() {
  const loader = new THREE.TextureLoader();
  
  // Texturas de planetas (usando URLs confiables)
  const textureUrls = {
    Sol: "https://i.postimg.cc/zGW5FLW0/sol.png",
    Mercurio: "https://i.postimg.cc/jSqQzfBG/mercurio.png",
    Venus: "https://i.postimg.cc/Znh60vrX/venus.png",
    Tierra: "https://i.postimg.cc/wTp1NdS6/image.png",
    Marte: "https://i.postimg.cc/x8S1LKp4/marte-textura.png",
    J√∫piter: "https://i.postimg.cc/W3mvLxSq/jupiter_textura.png",
    Saturno: "https://i.postimg.cc/T1Wn3qLQ/saturno.png",
    AnillosSaturno: "https://i.postimg.cc/SNXStZ8C/aros.png",
    Urano: "https://i.postimg.cc/dVFNgDp8/urano.png",
    Neptuno: "https://i.postimg.cc/HxFBzLb0/neptuno.png",
    Pluton: "https://i.postimg.cc/sDBswhc5/pluton.png",
    Luna: "https://i.postimg.cc/7hfrGbwg/luna.png",
    Glow: "https://threejs.org/examples/textures/lensflare/lensflare0.png"
  };
  
  const textures = {};
  Object.entries(textureUrls).forEach(([key, url]) => {
    textures[key] = loader.load(url, () => {
      updateProgress();
      // Configurar filtros para mejor calidad
      textures[key].minFilter = THREE.LinearFilter;
      textures[key].magFilter = THREE.LinearFilter;
    }, undefined, () => {
      // Fallback si falla la carga
      console.warn(`Fallo al cargar: ${key}`);
      updateProgress();
    });
  });
  
  // Crear objetos despu√©s de cargar texturas b√°sicas
  setTimeout(() => createSolarSystem(textures), 100);
}

// ================= CREACI√ìN DEL SISTEMA SOLAR =================
function createSolarSystem(textures) {
  // === SOL ===
  const sunRadius = 100;
  const sunGeo = new THREE.SphereGeometry(sunRadius, 64, 64);
  const sunMat = new THREE.MeshBasicMaterial({ 
    map: textures.Sol,
    emissive: 0xffaa00,
    emissiveIntensity: 0.3
  });
  sun = new THREE.Mesh(sunGeo, sunMat);
  sun.userData = { name: "Sol", isSun: true };
  scene.add(sun);
  planets.Sol = sun;
  
  // Glow del Sol (sprite con blending aditivo)
  const glowMat = new THREE.SpriteMaterial({
    map: textures.Glow,
    color: 0xffdd88,
    transparent: true,
    blending: THREE.AdditiveBlending,
    depthWrite: false,
    opacity: 0.6
  });
  const glow = new THREE.Sprite(glowMat);
  glow.scale.set(sunRadius * 6, sunRadius * 6, 1);
  sun.add(glow);
  
  // Corona solar sutil
  const coronaGeo = new THREE.SphereGeometry(sunRadius * 1.3, 32, 32);
  const coronaMat = new THREE.MeshBasicMaterial({
    color: 0xffaa44,
    transparent: true,
    opacity: 0.08,
    side: THREE.BackSide
  });
  const corona = new THREE.Mesh(coronaGeo, coronaMat);
  sun.add(corona);
  
  // === CREAR PLANETA (funci√≥n mejorada) ===
  function crearPlaneta(nombre, datos, textura) {
    // Radio escalado para visualizaci√≥n (no a escala real)
    const radioVisual = Math.max(3, Math.log10(datos.radius) * 8);
    
    const geo = new THREE.SphereGeometry(radioVisual, 48, 48);
    
    // Material con propiedades realistas
    const mat = new THREE.MeshStandardMaterial({
      map: textura,
      roughness: nombre === 'Tierra' ? 0.6 : 0.8,
      metalness: nombre === 'Tierra' ? 0.1 : 0,
      emissive: nombre === 'J√∫piter' ? 0x110500 : 0x000000,
      emissiveIntensity: nombre === 'J√∫piter' ? 0.1 : 0
    });
    
    const mesh = new THREE.Mesh(geo, mat);
    
    // Datos orbitales y f√≠sicos
    mesh.userData = {
      ...datos,
      angulo: Math.random() * Math.PI * 2,
      inclinacionOrbital: (Math.random() - 0.5) * 2, // Peque√±a variaci√≥n
      radioVisual: radioVisual,
      nombre: nombre,
      lunas: [],
      trail: [],
      maxTrail: 200
    };
    
    // Grupo para rotaci√≥n axial correcta
    const tiltGroup = new THREE.Group();
    tiltGroup.rotation.z = THREE.MathUtils.degToRad(datos.axialTilt || 0);
    tiltGroup.add(mesh);
    scene.add(tiltGroup);
    
    return { mesh, tiltGroup };
  }
  
  // === PLANETAS CON DATOS REALISTAS ===
  const planetConfigs = [
    { name: "Mercurio", data: PLANET_DATA.Mercurio, config: { radio: 2440, distancia: 400, velOrb: 0.000047, velRot: 0.00028, axialTilt: 0.03 } },
    { name: "Venus", data: PLANET_DATA.Venus, config: { radio: 6052, distancia: 600, velOrb: 0.000035, velRot: -0.00007, axialTilt: 177.4 } },
    { name: "Tierra", data: PLANET_DATA.Tierra, config: { radio: 6371, distancia: 800, velOrb: 0.000029, velRot: 0.001, axialTilt: 23.4 } },
    { name: "Marte", data: PLANET_DATA.Marte, config: { radio: 3390, distancia: 1000, velOrb: 0.000024, velRot: 0.00097, axialTilt: 25.2 } },
    { name: "J√∫piter", data: PLANET_DATA.J√∫piter, config: { radio: 69911, distancia: 1400, velOrb: 0.000013, velRot: 0.004, axialTilt: 3.1 } },
    { name: "Saturno", data: PLANET_DATA.Saturno, config: { radio: 58232, distancia: 1900, velOrb: 0.0000097, velRot: 0.0035, axialTilt: 26.7 } },
    { name: "Urano", data: PLANET_DATA.Urano, config: { radio: 25362, distancia: 2400, velOrb: 0.0000068, velRot: 0.0026, axialTilt: 97.8 } },
    { name: "Neptuno", data: PLANET_DATA.Neptuno, config: { radio: 24622, distancia: 2900, velOrb: 0.0000054, velRot: 0.0024, axialTilt: 28.3 } }
  ];
  
  planetConfigs.forEach(p => {
    const { mesh, tiltGroup } = crearPlaneta(p.name, p.config, textures[p.name]);
    planets[p.name] = { mesh, tiltGroup, config: p.config };
    
    // L√≠nea orbital
    if (CONFIG.showOrbits) {
      const orbitGeo = new THREE.RingGeometry(p.config.distancia - 1, p.config.distancia + 1, 128);
      const orbitMat = new THREE.MeshBasicMaterial({ 
        color: 0x4466aa, side: THREE.DoubleSide, transparent: true, opacity: 0.15 
      });
      const orbit = new THREE.Mesh(orbitGeo, orbitMat);
      orbit.rotation.x = Math.PI / 2;
      orbit.position.y = THREE.MathUtils.randFloatSpread(10);
      scene.add(orbit);
      orbitLines[p.name] = orbit;
    }
  });
  
  // === LUNAS ===
  function crearLuna(planetaMesh, nombre, distancia, velocidad, radio = 2) {
    const geo = new THREE.SphereGeometry(radio, 24, 24);
    const mat = new THREE.MeshStandardMaterial({ 
      map: textures.Luna,
      roughness: 0.9,
      metalness: 0
    });
    const luna = new THREE.Mesh(geo, mat);
    
    luna.userData = {
      nombre: nombre,
      planeta: planetaMesh,
      distancia: distancia,
      velocidad: velocidad,
      angulo: Math.random() * Math.PI * 2,
      radio: radio
    };
    
    scene.add(luna);
    planetaMesh.userData.lunas.push(luna);
    moons[nombre] = luna;
    return luna;
  }
  
  // Lunas principales
  crearLuna(planetas.Tierra.mesh, "Luna", 18, 0.012, 2.5);
  
  // Lunas de Marte
  crearLuna(planetas.Marte.mesh, "Fobos", 8, 0.015, 1.2);
  crearLuna(planetas.Marte.mesh, "Deimos", 12, 0.008, 0.9);
  
  // Lunas galileanas de J√∫piter
  ["Io", "Europa", "Ganimedes", "Calisto"].forEach((nombre, i) => {
    crearLuna(planetas.J√∫piter.mesh, nombre, 25 + i * 8, 0.008 - i * 0.001, 2.2 - i * 0.3);
  });
  
  // Lunas principales de Saturno
  ["Tit√°n", "Rea", "J√°peto", "Dione"].forEach((nombre, i) => {
    crearLuna(planetas.Saturno.mesh, nombre, 24 + i * 7, 0.006 - i * 0.0008, 2.5 - i * 0.4);
  });
  
  // === ANILLOS DE SATURNO (mejorados) ===
  const ringGeo = new THREE.RingGeometry(20, 48, 64);
  // Crear textura de anillos con gradiente
  const canvas = document.createElement('canvas');
  canvas.width = 512; canvas.height = 64;
  const ctx = canvas.getContext('2d');
  const gradient = ctx.createLinearGradient(0, 0, 512, 0);
  gradient.addColorStop(0, 'rgba(200,180,150,0)');
  gradient.addColorStop(0.2, 'rgba(220,200,170,0.6)');
  gradient.addColorStop(0.4, 'rgba(180,160,130,0.3)');
  gradient.addColorStop(0.6, 'rgba(230,210,180,0.7)');
  gradient.addColorStop(0.8, 'rgba(190,170,140,0.4)');
  gradient.addColorStop(1, 'rgba(210,190,160,0)');
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, 512, 64);
  const ringTexture = new THREE.CanvasTexture(canvas);
  
  const ringMat = new THREE.MeshStandardMaterial({
    map: ringTexture,
    side: THREE.DoubleSide,
    transparent: true,
    opacity: 0.85,
    roughness: 0.7,
    metalness: 0.1
  });
  const saturnRings = new THREE.Mesh(ringGeo, ringMat);
  saturnRings.rotation.x = Math.PI / 2 + 0.47; // Inclinaci√≥n realista
  saturnRings.userData = { planeta: "Saturno" };
  scene.add(saturnRings);
  rings.Saturno = saturnRings;
  
  // Anillos sutiles para Urano y J√∫piter
  function crearAnillosSutiles(planeta, radioInt, radioExt, inclinacion, color) {
    const geo = new THREE.RingGeometry(radioInt, radioExt, 32);
    const mat = new THREE.MeshBasicMaterial({
      color: color,
      side: THREE.DoubleSide,
      transparent: true,
      opacity: 0.25
    });
    const anillos = new THREE.Mesh(geo, mat);
    anillos.rotation.x = Math.PI / 2 + THREE.MathUtils.degToRad(inclinacion);
    scene.add(anillos);
    return anillos;
  }
  
  rings.J√∫piter = crearAnillosSutiles(planetas.J√∫piter.mesh, 15, 22, 0.3, 0x886644);
  rings.Urano = crearAnillosSutiles(planetas.Urano.mesh, 14, 24, 97.8, 0x6688aa);
  
  // === CINTUR√ìN DE ASTEROIDES (entre Marte y J√∫piter) ===
  function crearCinturon(nombre, distMin, distMax, numObjetos, escala) {
    const group = new THREE.Group();
    const geometries = [
      new THREE.IcosahedronGeometry(1, 0),
      new THREE.DodecahedronGeometry(1, 0),
      new THREE.OctahedronGeometry(1, 0)
    ];
    
    for (let i = 0; i < numObjetos; i++) {
      const geo = geometries[Math.floor(Math.random() * geometries.length)].clone();
      const size = escala * (0.3 + Math.random() * 0.7);
      geo.scale(size, size * (0.5 + Math.random()), size * (0.5 + Math.random()));
      
      const mat = new THREE.MeshStandardMaterial({
        color: 0x776655 + Math.floor(Math.random() * 0x221100),
        roughness: 0.9,
        metalness: 0.1
      });
      
      const ast = new THREE.Mesh(geo, mat);
      
      // Posici√≥n en √≥rbita el√≠ptica
      const ang = Math.random() * Math.PI * 2;
      const dist = distMin + Math.random() * (distMax - distMin);
      const eccentricity = 0.1 + Math.random() * 0.15;
      const x = dist * (1 - eccentricity * eccentricity) / (1 + eccentricity * Math.cos(ang)) * Math.cos(ang);
      const z = dist * (1 - eccentricity * eccentricity) / (1 + eccentricity * Math.cos(ang)) * Math.sin(ang);
      const y = THREE.MathUtils.randFloatSpread(30);
      
      ast.position.set(x, y, z);
      ast.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
      
      ast.userData = {
        distancia: dist,
        angulo: ang,
        velocidad: 0.000015 + Math.random() * 0.00001,
        eccentricity: eccentricity
      };
      
      group.add(ast);
    }
    scene.add(group);
    return group;
  }
  
  asteroidBelt = crearCinturon("asteroides", 1050, 1350, 2000, 1.5);
  
  // === CINTUR√ìN DE KUIPER (m√°s all√° de Neptuno) ===
  kuiperBelt = crearCinturon("kuiper", 2950, 4500, 1500, 0.8);
  
  // === ESTRELLAS DE FONDO (mejoradas) ===
  (function crearEstrellas() {
    const starGeo = new THREE.BufferGeometry();
    const starCount = 50000;
    const positions = new Float32Array(starCount * 3);
    const colors = new Float32Array(starCount * 3);
    const sizes = new Float32Array(starCount);
    
    const colorPalette = [
      new THREE.Color(0xffffff), // Blanco
      new THREE.Color(0xffeecc), // Amarillento
      new THREE.Color(0xccddff), // Azulado
      new THREE.Color(0xffccaa)  // Anaranjado
    ];
    
    for (let i = 0; i < starCount; i++) {
      // Distribuci√≥n esf√©rica
      const radius = 15000 + Math.random() * 35000;
      const theta = Math.random() * Math.PI * 2;
      const phi = Math.acos(2 * Math.random() - 1);
      
      positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
      positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
      positions[i * 3 + 2] = radius * Math.cos(phi);
      
      // Color aleatorio de la paleta
      const color = colorPalette[Math.floor(Math.random() * colorPalette.length)];
      colors[i * 3] = color.r;
      colors[i * 3 + 1] = color.g;
      colors[i * 3 + 2] = color.b;
      
      // Tama√±o variable con brillo
      sizes[i] = 0.5 + Math.random() * 2.5;
    }
    
    starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    starGeo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    starGeo.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
    
    const starMat = new THREE.PointsMaterial({
      size: 1.5,
      vertexColors: true,
      transparent: true,
      opacity: 0.9,
      sizeAttenuation: true
    });
    
    const stars = new THREE.Points(starGeo, starMat);
    scene.add(stars);
  })();
  
  // === NEBULOSA DE FONDO SUTIL ===
  (function crearNebulosa() {
    const nebulaGeo = new THREE.SphereGeometry(40000, 32, 32);
    const nebulaMat = new THREE.MeshBasicMaterial({
      color: 0x110822,
      transparent: true,
      opacity: 0.15,
      side: THREE.BackSide
    });
    const nebula = new THREE.Mesh(nebulaGeo, nebulaMat);
    scene.add(nebula);
  })();
}

// ================= UI Y EVENTOS =================
function setupUI() {
  // Slider de velocidad
  const velSlider = document.getElementById('velSlider');
  const velText = document.getElementById('velocidadText');
  
  velSlider.addEventListener('input', (e) => {
    CONFIG.timeSpeed = parseFloat(e.target.value);
    velText.textContent = CONFIG.timeSpeed.toFixed(1) + 'x';
  });
  
  document.getElementById('btnFaster').addEventListener('click', () => {
    CONFIG.timeSpeed = Math.min(10, CONFIG.timeSpeed + 0.5);
    velSlider.value = CONFIG.timeSpeed;
    velText.textContent = CONFIG.timeSpeed.toFixed(1) + 'x';
  });
  
  document.getElementById('btnSlower').addEventListener('click', () => {
    CONFIG.timeSpeed = Math.max(0.1, CONFIG.timeSpeed - 0.5);
    velSlider.value = CONFIG.timeSpeed;
    velText.textContent = CONFIG.timeSpeed.toFixed(1) + 'x';
  });
  
  // Pausa
  const btnPause = document.getElementById('btnPause');
  btnPause.addEventListener('click', () => {
    CONFIG.paused = !CONFIG.paused;
    btnPause.classList.toggle('active', CONFIG.paused);
    btnPause.textContent = CONFIG.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
  });
  
  // Selector de planetas
  document.querySelectorAll('.planet-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.target;
      irAPlaneta(target);
      
      // Actualizar UI
      document.querySelectorAll('.planet-btn').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    });
  });
  
  // Cerrar panel de info
  document.getElementById('closePlanetInfo').addEventListener('click', () => {
    document.getElementById('planetInfo').classList.remove('visible');
    selectedPlanet = null;
  });
  
  // Atajos de teclado
  document.addEventListener('keydown', (e) => {
    // Navegaci√≥n a planetas con teclas 1-9
    const planetKeys = ['sun', 'mercurio', 'venus', 'tierra', 'marte', 'jupiter', 'saturno', 'urano', 'neptuno'];
    if (e.key >= '1' && e.key <= '9') {
      const index = parseInt(e.key) - 1;
      if (planetKeys[index]) {
        irAPlaneta(planetKeys[index]);
        // Actualizar selector UI
        document.querySelectorAll('.planet-btn').forEach((b, i) => {
          b.classList.toggle('active', i === index);
        });
      }
    }
    
    // Pausa con P
    if (e.key.toLowerCase() === 'p') {
      CONFIG.paused = !CONFIG.paused;
      btnPause.classList.toggle('active', CONFIG.paused);
      btnPause.textContent = CONFIG.paused ? '‚ñ∂Ô∏è' : '‚è∏Ô∏è';
    }
    
    // Reset c√°mara con C
    if (e.key.toLowerCase() === 'c') {
      camera.position.set(0, 800, 2500);
      camera.lookAt(0, 0, 0);
    }
    
    // Toggle √≥rbitas con O
    if (e.key.toLowerCase() === 'o') {
      CONFIG.showOrbits = !CONFIG.showOrbits;
      Object.values(orbitLines).forEach(orbit => {
        orbit.visible = CONFIG.showOrbits;
      });
    }
  });
}

function setupEventListeners() {
  // Movimiento del rat√≥n para raycaster
  function onMouseMove(event) {
    mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
    mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
  }
  
  // Click para seleccionar planeta
  function onClick(event) {
    if (!controls.isLocked) return;
    
    raycaster.setFromCamera(mouse, camera);
    
    // Verificar colisi√≥n con planetas
    const planetMeshes = Object.values(planetas).map(p => p.mesh);
    const moonMeshes = Object.values(moons);
    const targets = [...planetMeshes, ...moonMeshes, sun];
    
    const intersects = raycaster.intersectObjects(targets, true);
    
    if (intersects.length > 0) {
      const selected = intersects[0].object;
      const nombre = selected.userData?.nombre || selected.userData?.name;
      
      if (nombre && PLANET_DATA[nombre]) {
        mostrarInfoPlaneta(nombre);
      }
    }
  }
  
  // Resize
  window.addEventListener('resize', () => {
    camera.aspect = innerWidth / innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
  });
}

// ================= FUNCIONES DE UTILIDAD =================
function irAPlaneta(nombre) {
  if (nombre === 'sun') {
    // Ir al Sol
    camera.position.set(0, 200, 400);
    camera.lookAt(0, 0, 0);
    return;
  }
  
  const planeta = planetas[nombre];
  if (!planeta) return;
  
  // Posicionar c√°mara cerca del planeta
  const offset = planeta.config.radioVisual * 8;
  camera.position.set(
    planeta.mesh.position.x + offset,
    planeta.mesh.position.y + offset * 0.5,
    planeta.mesh.position.z + offset
  );
  camera.lookAt(planeta.mesh.position);
  
  // Mostrar info autom√°ticamente
  mostrarInfoPlaneta(nombre);
}

function mostrarInfoPlaneta(nombre) {
  const data = PLANET_DATA[nombre];
  if (!data) return;
  
  document.getElementById('planetIcon').textContent = data.icon;
  document.getElementById('planetName').textContent = data.name;
  document.getElementById('planetDesc').textContent = data.desc;
  document.getElementById('planetDiameter').textContent = data.diameter;
  document.getElementById('planetDistance').textContent = data.distance;
  document.getElementById('planetOrbit').textContent = data.orbit;
  document.getElementById('planetRotation').textContent = data.rotation;
  document.getElementById('planetMoons').textContent = data.moons;
  document.getElementById('planetTemp').textContent = data.temp;
  
  const infoPanel = document.getElementById('planetInfo');
  infoPanel.classList.add('visible');
  selectedPlanet = nombre;
}

function actualizarCercano() {
  const cercanoDiv = document.getElementById('cercano');
  let masCercano = { nombre: "Espacio profundo", dist: Infinity };
  
  // Verificar planetas
  Object.entries(planetas).forEach(([nombre, { mesh }]) => {
    const d = camera.position.distanceTo(mesh.position);
    if (d < masCercano.dist && d < 500) {
      masCercano = { nombre: PLANET_DATA[nombre]?.name || nombre, dist: d };
    }
  });
  
  // Verificar lunas
  Object.values(moons).forEach(luna => {
    const d = camera.position.distanceTo(luna.position);
    if (d < masCercano.dist && d < 200) {
      masCercano = { nombre: luna.userData.nombre, dist: d };
    }
  });
  
  // Verificar Sol
  const dSol = camera.position.distanceTo(sun.position);
  if (dSol < masCercano.dist && dSol < 600) {
    masCercano = { nombre: "Sol", dist: dSol };
  }
  
  // Formato de distancia
  let distText = "";
  if (masCercano.dist < 100) {
    distText = `(${Math.round(masCercano.dist)} u)`;
  } else if (masCercano.dist < 1000) {
    distText = `(${(masCercano.dist/100).toFixed(1)}x distancia Tierra-Luna)`;
  }
  
  cercanoDiv.textContent = `ü™ê ${masCercano.nombre} ${distText}`.trim();
}

// ================= MINIMAP =================
function initMinimap() {
  minimapCanvas = document.getElementById('minimapCanvas');
  minimapCanvas.width = 180;
  minimapCanvas.height = 180;
  minimapCtx = minimapCanvas.getContext('2d');
}

function actualizarMinimap() {
  if (!minimapCtx) return;
  
  const ctx = minimapCtx;
  const w = minimapCanvas.width;
  const h = minimapCanvas.height;
  const cx = w / 2;
  const cy = h / 2;
  const scale = 0.03; // Escala para el minimap
  
  // Fondo
  ctx.fillStyle = 'rgba(5, 10, 25, 0.9)';
  ctx.fillRect(0, 0, w, h);
  
  // Dibujar √≥rbitas
  ctx.strokeStyle = 'rgba(100, 150, 255, 0.2)';
  ctx.lineWidth = 1;
  Object.values(planetas).forEach(({ config }) => {
    ctx.beginPath();
    ctx.arc(cx, cy, config.distancia * scale, 0, Math.PI * 2);
    ctx.stroke();
  });
  
  // Dibujar Sol
  ctx.fillStyle = '#ffcc44';
  ctx.beginPath();
  ctx.arc(cx, cy, 4, 0, Math.PI * 2);
  ctx.fill();
  
  // Dibujar planetas
  Object.entries(planetas).forEach(([nombre, { mesh, config }]) => {
    if (nombre === 'Sol') return;
    
    const x = cx + mesh.position.x * scale;
    const y = cy + mesh.position.z * scale;
    
    // Color seg√∫n planeta
    const colors = {
      Mercurio: '#aaa', Venus: '#e6c88c', Tierra: '#4fc3f7',
      Marte: '#e57373', J√∫piter: '#ffb74d', Saturno: '#f4a460',
      Urano: '#81d4fa', Neptuno: '#5c6bc0'
    };
    
    ctx.fillStyle = colors[nombre] || '#888';
    ctx.beginPath();
    ctx.arc(x, y, Math.max(2, config.radioVisual * 0.15), 0, Math.PI * 2);
    ctx.fill();
  });
  
  // Posici√≥n de la c√°mara (proyectada)
  const camX = cx + camera.position.x * scale;
  const camY = cy + camera.position.z * scale;
  
  ctx.strokeStyle = '#4fc3f7';
  ctx.lineWidth = 2;
  ctx.setLineDash([5, 3]);
  ctx.beginPath();
  ctx.moveTo(cx, cy);
  ctx.lineTo(camX, camY);
  ctx.stroke();
  ctx.setLineDash([]);
  
  ctx.fillStyle = '#4fc3f7';
  ctx.beginPath();
  ctx.arc(camX, camY, 3, 0, Math.PI * 2);
  ctx.fill();
  
  // Direcci√≥n de la c√°mara
  const dir = new THREE.Vector3(0, 0, -1);
  dir.applyQuaternion(camera.quaternion);
  ctx.strokeStyle = '#64b5f6';
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(camX, camY);
  ctx.lineTo(camX + dir.x * 15 * scale, camY + dir.z * 15 * scale);
  ctx.stroke();
}

// ================= ANIMACI√ìN PRINCIPAL =================
function animate() {
  requestAnimationFrame(animate);
  
  if (controls.isLocked) {
    // Movimiento de c√°mara
    const speed = CONFIG.cameraSpeed * (CONFIG.paused ? 0 : 1);
    if (moveState.forward) controls.moveForward(speed);
    if (moveState.backward) controls.moveForward(-speed);
    if (moveState.left) controls.moveRight(-speed);
    if (moveState.right) controls.moveRight(speed);
    if (moveState.up) camera.position.y += speed;
    if (moveState.down) camera.position.y -= speed;
  }
  
  if (!CONFIG.paused) {
    // Tiempo simulado
    timeElapsed += CONFIG.timeSpeed;
    document.getElementById('simTime').textContent = Math.floor(timeElapsed * 0.5).toLocaleString();
    
    // Rotaci√≥n del Sol
    sun.rotation.y += 0.0003 * CONFIG.timeSpeed;
    
    // Actualizar planetas
    Object.entries(planetas).forEach(([nombre, { mesh, tiltGroup, config }]) => {
      if (nombre === 'Sol') return;
      
      // Movimiento orbital
      mesh.userData.angulo += config.velOrb * CONFIG.timeSpeed;
      mesh.position.x = Math.cos(mesh.userData.angulo) * config.distancia;
      mesh.position.z = Math.sin(mesh.userData.angulo) * config.distancia;
      
      // Rotaci√≥n axial (sobre el eje inclinado)
      mesh.rotation.y += config.velRot * CONFIG.timeSpeed;
      
      // Trail orbital (para efecto visual)
      if (mesh.userData.trail.length > mesh.userData.maxTrail) {
        mesh.userData.trail.shift();
      }
      mesh.userData.trail.push(mesh.position.clone());
    });
    
    // Actualizar lunas
    Object.values(moons).forEach(luna => {
      const data = luna.userData;
      data.angulo += data.velocidad * CONFIG.timeSpeed;
      
      // Posici√≥n relativa al planeta
      const planeta = data.planeta;
      luna.position.x = planeta.position.x + Math.cos(data.angulo) * data.distancia;
      luna.position.z = planeta.position.z + Math.sin(data.angulo) * data.distancia;
      luna.position.y = planeta.position.y + Math.sin(data.angulo * 0.7) * (data.distancia * 0.1);
      
      // Rotaci√≥n de la luna
      luna.rotation.y += 0.002 * CONFIG.timeSpeed;
    });
    
    // Anillos de Saturno (seguir al planeta)
    if (rings.Saturno && planetas.Saturno) {
      rings.Saturno.position.copy(planetas.Saturno.mesh.position);
    }
    
    // Actualizar cintur√≥n de asteroides
    if (asteroidBelt) {
      asteroidBelt.children.forEach(ast => {
        if (ast.userData.velocidad) {
          ast.userData.angulo += ast.userData.velocidad * CONFIG.timeSpeed;
          const e = ast.userData.eccentricity;
          const r = ast.userData.distancia * (1 - e*e) / (1 + e * Math.cos(ast.userData.angulo));
          ast.position.x = r * Math.cos(ast.userData.angulo);
          ast.position.z = r * Math.sin(ast.userData.angulo);
          ast.rotation.x += 0.001 * CONFIG.timeSpeed;
          ast.rotation.y += 0.0015 * CONFIG.timeSpeed;
        }
      });
    }
    
    // Cintur√≥n de Kuiper (movimiento m√°s lento)
    if (kuiperBelt) {
      kuiperBelt.children.forEach((ast, i) => {
        if (ast.userData.velocidad) {
          ast.userData.angulo += ast.userData.velocidad * 0.6 * CONFIG.timeSpeed;
          const e = ast.userData.eccentricity;
          const r = ast.userData.distancia * (1 - e*e) / (1 + e * Math.cos(ast.userData.angulo));
          ast.position.x = r * Math.cos(ast.userData.angulo);
          ast.position.z = r * Math.sin(ast.userData.angulo);
        }
      });
    }
  }
  
  // Actualizar UI
  actualizarCercano();
  actualizarMinimap();
  
  // Renderizar
  renderer.render(scene, camera);
}

// ================= ESTADO DE MOVIMIENTO =================
const moveState = {
  forward: false, backward: false,
  left: false, right: false,
  up: false, down: false
};

document.addEventListener('keydown', (e) => {
  switch(e.code) {
    case 'KeyW': moveState.forward = true; break;
    case 'KeyS': moveState.backward = true; break;
    case 'KeyA': moveState.left = true; break;
    case 'KeyD': moveState.right = true; break;
    case 'KeyE': moveState.up = true; break;
    case 'KeyQ': moveState.down = true; break;
  }
});

document.addEventListener('keyup', (e) => {
  switch(e.code) {
    case 'KeyW': moveState.forward = false; break;
    case 'KeyS': moveState.backward = false; break;
    case 'KeyA': moveState.left = false; break;
    case 'KeyD': moveState.right = false; break;
    case 'KeyE': moveState.up = false; break;
    case 'KeyQ': moveState.down = false; break;
  }
});

// ================= INICIAR =================
window.addEventListener('load', init);
</script>
</body>
</html>
