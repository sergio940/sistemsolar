<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Sistema Solar 3D Completo</title>
<style>
body{margin:0;overflow:hidden;background:black;font-family:Arial}
#info{
  position:absolute;top:10px;left:10px;
  color:white;background:rgba(0,0,0,.6);
  padding:10px;border-radius:6px;z-index:2
}
#cercano{
  position:absolute;top:50px;left:10px;
  color:#0f0;background:rgba(0,0,0,.6);
  padding:6px;border-radius:6px;font-size:14px;z-index:2;
}
</style>
</head>
<body>

<div id="info">WASD mover · Ratón mirar · Q/E subir/bajar</div>
<div id="cercano">Cerca de: —</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

<script>
// ================= ESCENA =================
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 200000);
camera.position.set(0, 500, 1800);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

// ================= TEXTURAS =================
const loader = new THREE.TextureLoader();
const textures = {
  Sol:"https://i.postimg.cc/zGW5FLW0/sol.png",
  Mercurio:"https://i.postimg.cc/jSqQzfBG/mercurio.png",
  Venus:"https://i.postimg.cc/Znh60vrX/venus.png",
  Tierra:"https://i.postimg.cc/wTp1NdS6/image.png",
  Marte:"https://i.postimg.cc/x8S1LKp4/marte-textura.png",
  Júpiter:"https://i.postimg.cc/W3mvLxSq/jupiter_textura.png",
  Saturno:"https://i.postimg.cc/T1Wn3qLQ/saturno.png",
  AnillosSaturno:"https://i.postimg.cc/156xqbwY/anillos2.png",
  Urano:"https://i.postimg.cc/dVFNgDp8/urano.png",
  Neptuno:"https://i.postimg.cc/HxFBzLb0/neptuno.png",
  Pluton:"https://i.postimg.cc/sDBswhc5/pluton.png",
  Luna:"https://i.postimg.cc/7hfrGbwg/luna.png"
};

// ================= LUZ =================
const sunLight = new THREE.PointLight(0xffffff, 3, 0);
scene.add(sunLight);

// ================= SOL =================
const sun = new THREE.Mesh(
  new THREE.SphereGeometry(60,64,64),
  new THREE.MeshBasicMaterial({map: loader.load(textures.Sol)})
);
scene.add(sun);

// Glow
const glowTexture = loader.load("https://threejs.org/examples/textures/lensflare/lensflare0.png");
const glow = new THREE.Sprite(new THREE.SpriteMaterial({map: glowTexture, color:0xffddaa, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false}));
glow.scale.set(500,500,1);
sun.add(glow);

// ================= ESTRELLAS =================
(function(){
  const g = new THREE.BufferGeometry();
  const v = [];
  for(let i=0;i<70000;i++){
    const r = 20000 + Math.random()*20000;
    const t = Math.random()*Math.PI*2;
    const p = Math.acos(THREE.MathUtils.randFloatSpread(2));
    v.push(r*Math.sin(p)*Math.cos(t), r*Math.sin(p)*Math.sin(t), r*Math.cos(p));
  }
  g.setAttribute("position", new THREE.Float32BufferAttribute(v,3));
  scene.add(new THREE.Points(g, new THREE.PointsMaterial({size:1})));
})();

// ================= CREAR PLANETA =================
function crearPlaneta(nombre,opt){
  const mesh = new THREE.Mesh(
    new THREE.SphereGeometry(opt.radio,48,48),
    new THREE.MeshStandardMaterial({map:loader.load(textures[nombre])})
  );
  mesh.userData = {
    distancia: opt.distancia,
    angulo: Math.random()*Math.PI*2,
    velOrb: opt.velOrb,
    velRot: opt.velRot,
    nombre: nombre,
    lunas: []
  };
  scene.add(mesh);
  return mesh;
}

// ================= PLANETAS =================
const mercurio = crearPlaneta("Mercurio",{radio:4,distancia:150,velOrb:.00005,velRot:.001});
const venus    = crearPlaneta("Venus",{radio:7,distancia:220,velOrb:.00004,velRot:.0008});
const tierra   = crearPlaneta("Tierra",{radio:8,distancia:300,velOrb:.000035,velRot:.001});
const marte    = crearPlaneta("Marte",{radio:5,distancia:380,velOrb:.00003,velRot:.0009});
const jupiter  = crearPlaneta("Júpiter",{radio:18,distancia:480,velOrb:.00002,velRot:.002});
const saturno  = crearPlaneta("Saturno",{radio:16,distancia:580,velOrb:.000015,velRot:.0015});
const urano    = crearPlaneta("Urano",{radio:13,distancia:650,velOrb:.000012,velRot:.0012});
const neptuno  = crearPlaneta("Neptuno",{radio:13,distancia:720,velOrb:.00001,velRot:.001});
const pluton   = crearPlaneta("Pluton",{radio:6,distancia:800,velOrb:.000008,velRot:.0007});

// ================= INCLINACIONES =================
tierra.rotation.z=.41; marte.rotation.z=.44; jupiter.rotation.z=.05;
saturno.rotation.z=.47; urano.rotation.z=1.71; neptuno.rotation.z=.49;

// ================= CREAR LUNAS =================
function crearLuna(planeta,dist,vel,nombre){
  const l = new THREE.Mesh(new THREE.SphereGeometry(2,24,24),
        new THREE.MeshStandardMaterial({map:loader.load(textures.Luna)}));
  l.userData = {orbita:planeta,distancia:dist,velocidad:vel,angulo:Math.random()*Math.PI*2,nombre:nombre};
  scene.add(l); 
  planeta.userData.lunas.push(l);
  return l;
}

// Tierra
crearLuna(tierra,14,0.01,"Luna");
// Marte
crearLuna(marte,6,0.008,"Fobos");
crearLuna(marte,10,0.006,"Deimos");
// Júpiter
crearLuna(jupiter,22,0.006,"Io");
crearLuna(jupiter,28,0.005,"Europa");
crearLuna(jupiter,34,0.004,"Ganimedes");
crearLuna(jupiter,40,0.003,"Calisto");
// Saturno
crearLuna(saturno,22,0.004,"Titán");
crearLuna(saturno,28,0.0035,"Rea");
crearLuna(saturno,34,0.003,"Jápeto");
crearLuna(saturno,40,0.0025,"Dione");
// Urano
crearLuna(urano,18,0.003,"Miranda");
crearLuna(urano,22,0.0028,"Ariel");
crearLuna(urano,26,0.0025,"Umbriel");
crearLuna(urano,30,0.0022,"Titania");
crearLuna(urano,34,0.002,"Oberón");
// Neptuno
crearLuna(neptuno,18,0.0025,"Tritón");
crearLuna(neptuno,24,0.0022,"Nereida");
// Plutón
crearLuna(pluton,8,0.0018,"Caronte");
crearLuna(pluton,12,0.0015,"Nix");
crearLuna(pluton,16,0.0013,"Hidra");

// ================= ANILLOS SATURNO =================
const ringSatGeo = new THREE.RingGeometry(18, 40, 128);
const ringSatMat = new THREE.MeshBasicMaterial({map:loader.load(textures.AnillosSaturno), side:THREE.DoubleSide, transparent:true});
const ringSat = new THREE.Mesh(ringSatGeo, ringSatMat);
ringSat.rotation.x = Math.PI/2 + 0.25;
ringSat.rotation.z = 0.45;
scene.add(ringSat);

// ================= CONTROLES =================
const controls = new THREE.PointerLockControls(camera, document.body);
document.body.addEventListener("click", ()=>controls.lock());
const move={f:false,b:false,l:false,r:false,u:false,d:false};
document.addEventListener("keydown",e=>{if(e.code==="KeyW")move.f=true;if(e.code==="KeyS")move.b=true;if(e.code==="KeyA")move.l=true;if(e.code==="KeyD")move.r=true;if(e.code==="KeyE")move.u=true;if(e.code==="KeyQ")move.d=true;});
document.addEventListener("keyup",e=>{if(e.code==="KeyW")move.f=false;if(e.code==="KeyS")move.b=false;if(e.code==="KeyA")move.l=false;if(e.code==="KeyD")move.r=false;if(e.code==="KeyE")move.u=false;if(e.code==="KeyQ")move.d=false;});

// ================= PLANETA MÁS CERCANO =================
const cercanoDiv = document.getElementById("cercano");
function actualizarCercano(){
  const todos=[mercurio,venus,tierra,marte,jupiter,saturno,urano,neptuno,pluton];
  let masCercano = {nombre:"—", dist:Infinity};
  todos.forEach(p=>{
    const d = camera.position.distanceTo(p.position);
    if(d < masCercano.dist){ masCercano = {nombre:p.userData.nombre, dist:d}; }
    p.userData.lunas.forEach(l=>{
      const dl = camera.position.distanceTo(l.position);
      if(dl < masCercano.dist){ masCercano = {nombre:l.userData.nombre, dist:dl}; }
    });
  });
  cercanoDiv.textContent = `Cerca de: ${masCercano.nombre}`;
}

// ================= ANIMACIÓN =================
function animate(){
  requestAnimationFrame(animate);
  const s=6;
  if(move.f)controls.moveForward(s);
  if(move.b)controls.moveForward(-s);
  if(move.l)controls.moveRight(-s);
  if(move.r)controls.moveRight(s);
  if(move.u)camera.position.y+=s;
  if(move.d)camera.position.y-=s;

  // órbitas planetas y lunas
  [mercurio,venus,tierra,marte,jupiter,saturno,urano,neptuno,pluton].forEach(p=>{
    p.userData.angulo+=p.userData.velOrb;
    p.position.x=Math.cos(p.userData.angulo)*p.userData.distancia;
    p.position.z=Math.sin(p.userData.angulo)*p.userData.distancia;
    p.rotation.y+=p.userData.velRot;
    p.userData.lunas.forEach(l=>{
      l.userData.angulo+=l.userData.velocidad;
      l.position.x = p.position.x + Math.cos(l.userData.angulo)*l.userData.distancia;
      l.position.z = p.position.z + Math.sin(l.userData.angulo)*l.userData.distancia;
    });
  });

  // anillo saturno
  ringSat.position.copy(saturno.position);

  actualizarCercano();
  renderer.render(scene,camera);
}
animate();

// ================= RESIZE =================
addEventListener("resize",()=>{camera.aspect=innerWidth/innerHeight;camera.updateProjectionMatrix();renderer.setSize(innerWidth,innerHeight);});
</script>
</body>
</html>
